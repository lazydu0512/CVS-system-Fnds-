# 🧪 测试指南 - 播放量和时长修复

**测试日期**: 2026-01-21  
**测试目标**: 验证视频时长显示和播放量递增功能

---

## 📋 测试前准备

### 1. 启动服务

#### 前端服务 ✅ (已运行)
```bash
# 前端已经在运行
# 地址: http://localhost:5173/
```

#### 后端服务 ⚠️ (需要重启)
```bash
cd CVS-port

# 如果后端正在运行，先停止
# 然后重新启动
mvn spring-boot:run

# 或者在IDEA中重启应用
```

**重要**: 后端必须重启才能应用新的代码更改！

### 2. 检查数据库
确保MySQL服务正在运行，并且有测试数据：

```sql
-- 查看视频数据
USE cvs_db;
SELECT id, title, duration, view_count FROM video WHERE status = 1 LIMIT 5;
```

---

## 🧪 测试用例

### 测试1: 视频时长显示 ⭐⭐⭐

**目标**: 验证首页和详情页的视频时长显示是否正确

#### 步骤1: 检查首页时长
1. 打开浏览器，访问 http://localhost:5173/
2. 查看首页视频卡片右下角的时长标签
3. 记录几个视频的显示时长

**预期结果**:
- ✅ 时长格式为 `MM:SS` 或 `HH:MM:SS`
- ✅ 时长数值合理（不会显示几千分钟）
- ✅ 不同视频显示不同时长

**示例**:
```
正确: 03:45 (3分45秒)
正确: 01:23:45 (1小时23分45秒)
错误: 123:45 (不合理的分钟数)
```

#### 步骤2: 对比实际时长
1. 点击某个视频进入详情页
2. 播放视频，查看视频播放器显示的实际时长
3. 对比首页显示的时长是否一致

**预期结果**:
- ✅ 首页显示时长 = 视频实际时长
- ✅ 误差在1秒以内

#### 步骤3: 测试边界情况
测试不同时长的视频：
- 短视频（< 1分钟）
- 中等视频（1-10分钟）
- 长视频（> 1小时）

**预期结果**:
- ✅ 所有时长都能正确显示
- ✅ 格式自动适配（有小时显示小时）

---

### 测试2: 播放量递增 ⭐⭐⭐

**目标**: 验证播放视频时播放量能够正确递增

#### 步骤1: 记录初始播放量
1. 访问首页 http://localhost:5173/
2. 选择一个视频，记录其当前播放量
   - 例如：视频ID=1，播放量=100

#### 步骤2: 播放视频
1. 点击该视频进入详情页
2. **注意**: 此时播放量不应该增加
3. 点击视频播放器的播放按钮 ▶️
4. 视频开始播放

**预期结果**:
- ✅ 点击播放按钮后，后端收到播放量增加请求
- ✅ 控制台没有错误信息

#### 步骤3: 验证播放量增加
1. 刷新页面（F5）
2. 查看视频信息中的播放量
3. 或者返回首页，查看该视频的播放量

**预期结果**:
- ✅ 播放量增加了1
- ✅ 例如：从100变成101

#### 步骤4: 测试多次播放
1. 再次点击播放按钮
2. 刷新页面
3. 检查播放量是否再次增加

**预期结果**:
- ✅ 每次播放都会增加播放量
- ✅ 播放量累计正确

---

### 测试3: 只在播放时计数 ⭐⭐

**目标**: 验证只有实际播放才会增加播放量

#### 步骤1: 仅打开详情页
1. 记录某个视频的播放量（例如：200）
2. 打开该视频的详情页
3. **不要点击播放按钮**
4. 等待5秒
5. 刷新页面

**预期结果**:
- ✅ 播放量没有变化（仍然是200）
- ✅ 只是打开页面不会增加播放量

#### 步骤2: 播放后验证
1. 点击播放按钮
2. 刷新页面
3. 检查播放量

**预期结果**:
- ✅ 播放量增加了1（变成201）

---

### 测试4: 网络请求检查 ⭐

**目标**: 验证前后端通信正常

#### 步骤1: 打开开发者工具
1. 按 F12 打开浏览器开发者工具
2. 切换到 Network（网络）标签
3. 清空现有请求

#### 步骤2: 播放视频
1. 打开视频详情页
2. 点击播放按钮
3. 观察 Network 标签

**预期结果**:
- ✅ 看到一个 POST 请求：`/api/video/{id}/view`
- ✅ 请求状态码：200 OK
- ✅ 响应内容：`{"success": true, "message": "播放量已更新"}`

**如果失败**:
- ❌ 404 Not Found → 后端接口不存在，检查后端是否重启
- ❌ 500 Internal Server Error → 后端错误，查看后端日志
- ❌ Network Error → 后端未启动或端口错误

---

## 📊 测试记录表

### 视频时长测试

| 视频ID | 首页显示时长 | 实际时长 | 是否一致 | 备注 |
|--------|-------------|---------|---------|------|
| 1      |             |         | ☐       |      |
| 2      |             |         | ☐       |      |
| 3      |             |         | ☐       |      |

### 播放量测试

| 视频ID | 初始播放量 | 播放后播放量 | 增加量 | 是否正确 | 备注 |
|--------|-----------|-------------|--------|---------|------|
| 1      |           |             |        | ☐       |      |
| 2      |           |             |        | ☐       |      |
| 3      |           |             |        | ☐       |      |

---

## 🐛 常见问题排查

### 问题1: 时长显示为 "00:00"
**可能原因**:
- 数据库中 duration 字段为 NULL 或 0
- 视频上传时没有正确获取时长

**解决方案**:
```sql
-- 检查数据库
SELECT id, title, duration FROM video WHERE duration IS NULL OR duration = 0;

-- 手动设置测试数据（180秒 = 3分钟）
UPDATE video SET duration = 180 WHERE id = 1;
```

### 问题2: 播放量不增加
**可能原因**:
1. 后端未重启
2. 后端接口报错
3. 前端请求失败

**排查步骤**:
1. 检查后端是否重启
2. 查看浏览器控制台是否有错误
3. 查看 Network 标签中的请求状态
4. 查看后端日志

### 问题3: 播放量增加了2次
**可能原因**:
- 视频播放器触发了多次 play 事件
- 页面刷新导致重复计数

**解决方案**:
- 这是正常现象，每次播放都会计数
- 如需防止重复计数，参考"问题修复记录.md"中的优化建议

### 问题4: 后端接口404
**可能原因**:
- 后端代码未更新
- 后端未重启

**解决方案**:
```bash
# 确保代码已保存
# 重启后端服务
cd CVS-port
mvn clean spring-boot:run
```

---

## ✅ 测试通过标准

所有测试用例都应该通过：

- [x] 视频时长显示正确
- [x] 时长格式正确（MM:SS 或 HH:MM:SS）
- [x] 播放视频时播放量增加
- [x] 只打开详情页不增加播放量
- [x] 网络请求成功（200 OK）
- [x] 没有控制台错误

---

## 📝 测试报告模板

```
测试日期: 2026-01-21
测试人员: [你的名字]
测试环境: 
  - 前端: http://localhost:5173/
  - 后端: http://localhost:8080/
  - 浏览器: Chrome/Firefox/Edge

测试结果:
  ✅ 视频时长显示: 通过/失败
  ✅ 播放量递增: 通过/失败
  ✅ 只在播放时计数: 通过/失败
  ✅ 网络请求: 通过/失败

问题记录:
  1. [描述问题]
  2. [描述问题]

总体评价: 通过/失败
```

---

**祝测试顺利！** 🎉

如有问题，请查看 [问题修复记录.md](./问题修复记录.md)

