# æ¼”å”±ä¼šè§†é¢‘åˆ†äº«å¹³å° - APIæ¥å£æ–‡æ¡£

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

- **Base URL**: `http://localhost:8080/api`
- **è®¤è¯æ–¹å¼**: Bearer Token (JWT)
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8
- **æœ€åæ›´æ–°**: 2026-02-01

---

## ğŸ” è®¤è¯è¯´æ˜

### Tokenä½¿ç”¨
éœ€è¦è®¤è¯çš„æ¥å£éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦Tokenï¼š
```http
Authorization: Bearer {token}
```

### è·å–Token
é€šè¿‡ç™»å½•æ¥å£è·å–Tokenï¼Œç™»å½•æˆåŠŸåè¿”å›çš„`token`å­—æ®µå³ä¸ºè®¤è¯ä»¤ç‰Œã€‚

### Tokenå¤±æ•ˆ
Tokenæœ‰æ•ˆæœŸä¸º7å¤©ï¼Œè¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•ã€‚

---

## ğŸ“ ç»Ÿä¸€å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {}
}
```

### å¤±è´¥å“åº”
```json
{
  "success": false,
  "message": "é”™è¯¯ä¿¡æ¯"
}
```

---

## ğŸ”‘ ç”¨æˆ·ç›¸å…³æ¥å£

### 1. ç”¨æˆ·æ³¨å†Œ ğŸ†•
- **æ¥å£**: `POST /api/user/register`
- **è®¤è¯**: âŒ ä¸éœ€è¦
- **è¯´æ˜**: æ³¨å†Œæ—¶éœ€ä¸Šä¼ å¤´åƒï¼Œå¯†ç è‡ªåŠ¨BCryptåŠ å¯†
- **è¯·æ±‚ä½“**:
```json
{
  "username": "testuser",
  "password": "123456",
  "nickname": "æµ‹è¯•ç”¨æˆ·",
  "email": "test@example.com",
  "phone": "13800138000",
  "avatar": "https://oss.aliyuncs.com/avatars/xxx.jpg"
}
```
- **å“åº”**:
```json
{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸ"
}
```

### 2. ç”¨æˆ·ç™»å½• ğŸ”
- **æ¥å£**: `POST /api/user/login`
- **è®¤è¯**: âŒ ä¸éœ€è¦
- **è¯´æ˜**: ä½¿ç”¨BCryptéªŒè¯å¯†ç 
- **è¯·æ±‚ä½“**:
```json
{
  "username": "admin",
  "password": "123456"
}
```
- **å“åº”**:
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "user": {
    "id": 1,
    "username": "admin",
    "nickname": "ç³»ç»Ÿç®¡ç†å‘˜",
    "email": "admin@cvs.com",
    "avatar": "https://oss.aliyuncs.com/avatars/admin.jpg",
    "role": 1,
    "status": 0
  },
  "token": "eyJhbGciOiJIUzI1NiJ9..."
}
```

### 3. è·å–ç”¨æˆ·ä¿¡æ¯
- **æ¥å£**: `GET /api/user/{id}`
- **è®¤è¯**: âŒ ä¸éœ€è¦
- **å“åº”**: è¿”å›ç”¨æˆ·å¯¹è±¡ï¼ˆä¸å«å¯†ç ï¼‰

### 4. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- **æ¥å£**: `PUT /api/user/{id}`
- **è®¤è¯**: âœ… éœ€è¦
- **è¯·æ±‚ä½“**:
```json
{
  "nickname": "æ–°æ˜µç§°",
  "email": "new@example.com",
  "phone": "13900139000",
  "avatar": "https://oss.aliyuncs.com/avatars/new.jpg"
}
```

### 5. ä¿®æ”¹å¯†ç  ğŸ” ğŸ†•
- **æ¥å£**: `POST /api/user/change-password`
- **è®¤è¯**: âœ… éœ€è¦
- **è¯´æ˜**: éœ€éªŒè¯åŸå¯†ç ï¼Œæ–°å¯†ç è‡ªåŠ¨BCryptåŠ å¯†
- **è¯·æ±‚ä½“**:
```json
{
  "oldPassword": "123456",
  "newPassword": "654321"
}
```
- **å“åº”**:
```json
{
  "success": true,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸ"
}
```

### 6. ç®¡ç†å‘˜ä¿®æ”¹ç”¨æˆ·å¯†ç  ğŸ” ğŸ†•
- **æ¥å£**: `POST /api/user/{id}/admin-change-password`
- **è®¤è¯**: âœ… éœ€è¦ï¼ˆç®¡ç†å‘˜ï¼‰
- **è¯´æ˜**: ç®¡ç†å‘˜é‡ç½®ç”¨æˆ·å¯†ç ï¼Œæ–°å¯†ç è‡ªåŠ¨BCryptåŠ å¯†
- **è¯·æ±‚ä½“**:
```json
{
  "newPassword": "newpass123"
}
```

---

## ğŸ¬ è§†é¢‘ç›¸å…³æ¥å£

### 1. è·å–è§†é¢‘åˆ—è¡¨
- **æ¥å£**: `GET /api/video/list`
- **è®¤è¯**: âŒ ä¸éœ€è¦
- **å‚æ•°**:
  - `current`: å½“å‰é¡µç ï¼ˆé»˜è®¤1ï¼‰
  - `size`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤10ï¼‰
  - `city`: åŸå¸‚ç­›é€‰ï¼ˆå¯é€‰ï¼‰
  - `title`: æ ‡é¢˜æœç´¢ï¼ˆå¯é€‰ï¼‰
- **ç¤ºä¾‹**: `/api/video/list?current=1&size=10&city=åŒ—äº¬`
- **å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "title": "å‘¨æ°ä¼¦æ¼”å”±ä¼š",
      "description": "ç²¾å½©ç‰‡æ®µ",
      "city": "åŒ—äº¬",
      "concertDate": "2024-01-20",
      "videoUrl": "https://oss.aliyuncs.com/videos/xxx.mp4",
      "thumbnailUrl": "https://oss.aliyuncs.com/thumbs/xxx.jpg",
      "duration": 300,
      "uploaderId": 2,
      "uploaderName": "ç”¨æˆ·æ˜µç§°",
      "viewCount": 1000,
      "likeCount": 50,
      "collectCount": 20,
      "status": 1,
      "createTime": "2024-01-20 10:00:00"
    }
  ],
  "total": 100,
  "current": 1,
  "pages": 10
}
```

### 2. è·å–è§†é¢‘è¯¦æƒ…
- **æ¥å£**: `GET /api/video/{id}`
- **è®¤è¯**: âŒ ä¸éœ€è¦
- **è¯´æ˜**: è‡ªåŠ¨å¢åŠ è§‚çœ‹æ¬¡æ•°
- **å“åº”**: è¿”å›è§†é¢‘å¯¹è±¡

### 3. ä¸Šä¼ è§†é¢‘
- **æ¥å£**: `POST /api/video/upload`
- **è®¤è¯**: âœ… éœ€è¦
- **è¯´æ˜**: è§†é¢‘æ–‡ä»¶å…ˆä¸Šä¼ åˆ°OSSï¼Œå†æäº¤å…ƒæ•°æ®
- **è¯·æ±‚ä½“**:
```json
{
  "title": "å‘¨æ°ä¼¦æ¼”å”±ä¼š",
  "description": "ç²¾å½©ç‰‡æ®µ",
  "city": "åŒ—äº¬",
  "concertDate": "2024-01-20",
  "videoUrl": "https://oss.aliyuncs.com/videos/xxx.mp4",
  "thumbnailUrl": "https://oss.aliyuncs.com/thumbs/xxx.jpg",
  "duration": 300
}
```

### 4. è·å–ç”¨æˆ·è§†é¢‘
- **æ¥å£**: `GET /api/video/user/{userId}`
- **è®¤è¯**: âŒ ä¸éœ€è¦
- **å“åº”**: è¿”å›è¯¥ç”¨æˆ·ä¸Šä¼ çš„æ‰€æœ‰è§†é¢‘

### 5. è·å–å¾…å®¡æ ¸è§†é¢‘
- **æ¥å£**: `GET /api/video/pending`
- **è®¤è¯**: âœ… éœ€è¦ï¼ˆç®¡ç†å‘˜ï¼‰
- **å“åº”**: è¿”å›æ‰€æœ‰å¾…å®¡æ ¸è§†é¢‘åˆ—è¡¨

### 6. å®¡æ ¸è§†é¢‘
- **æ¥å£**: `POST /api/video/{id}/review`
- **è®¤è¯**: âœ… éœ€è¦ï¼ˆç®¡ç†å‘˜ï¼‰
- **è¯·æ±‚ä½“**:
```json
{
  "status": 1,
  "reviewComment": "å®¡æ ¸é€šè¿‡"
}
```
- **è¯´æ˜**: status: 1-é€šè¿‡, 2-æ‹’ç»

### 7. åˆ é™¤è§†é¢‘
- **æ¥å£**: `DELETE /api/video/{id}`
- **è®¤è¯**: âœ… éœ€è¦
- **æƒé™**: è§†é¢‘ä¸Šä¼ è€…æˆ–ç®¡ç†å‘˜
- **è¯´æ˜**: åŒæ—¶åˆ é™¤OSSä¸Šçš„è§†é¢‘æ–‡ä»¶

---

## ğŸ’¬ è¯„è®ºç›¸å…³æ¥å£

### 1. æ·»åŠ è¯„è®º
- **æ¥å£**: `POST /api/comment`
- **è®¤è¯**: âœ… éœ€è¦
- **è¯·æ±‚ä½“**:
```json
{
  "videoId": 1,
  "content": "å¤ªç²¾å½©äº†ï¼",
  "parentId": null
}
```

### 2. è·å–è§†é¢‘è¯„è®º
- **æ¥å£**: `GET /api/comment/video/{videoId}`
- **è®¤è¯**: âŒ ä¸éœ€è¦
- **å“åº”**: è¿”å›è¯¥è§†é¢‘çš„æ‰€æœ‰è¯„è®ºï¼ˆå«ç”¨æˆ·ä¿¡æ¯ï¼‰

### 3. åˆ é™¤è¯„è®º
- **æ¥å£**: `DELETE /api/comment/{id}`
- **è®¤è¯**: âœ… éœ€è¦
- **æƒé™**: è¯„è®ºä½œè€…æˆ–ç®¡ç†å‘˜

---

## ğŸ‘ ç‚¹èµç›¸å…³æ¥å£

### 1. ç‚¹èµ/å–æ¶ˆç‚¹èµ
- **æ¥å£**: `POST /api/video-like/{videoId}`
- **è®¤è¯**: âœ… éœ€è¦
- **å“åº”**:
```json
{
  "success": true,
  "message": "ç‚¹èµæˆåŠŸ",
  "liked": true
}
```

### 2. æ£€æŸ¥ç‚¹èµçŠ¶æ€
- **æ¥å£**: `GET /api/video-like/{videoId}/status`
- **è®¤è¯**: âœ… éœ€è¦
- **å“åº”**:
```json
{
  "success": true,
  "liked": true
}
```

---

## â­ æ”¶è—ç›¸å…³æ¥å£

### 1. æ”¶è—/å–æ¶ˆæ”¶è—
- **æ¥å£**: `POST /api/video-collect/{videoId}`
- **è®¤è¯**: âœ… éœ€è¦
- **å“åº”**:
```json
{
  "success": true,
  "message": "æ”¶è—æˆåŠŸ",
  "collected": true
}
```

### 2. æ£€æŸ¥æ”¶è—çŠ¶æ€
- **æ¥å£**: `GET /api/video-collect/{videoId}/status`
- **è®¤è¯**: âœ… éœ€è¦

### 3. è·å–ç”¨æˆ·æ”¶è—
- **æ¥å£**: `GET /api/video-collect/user`
- **è®¤è¯**: âœ… éœ€è¦
- **å“åº”**: è¿”å›å½“å‰ç”¨æˆ·çš„æ”¶è—åˆ—è¡¨

---

## ğŸ“ æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼ˆOSSï¼‰ğŸ†•

### 1. è·å–OSSä¸Šä¼ å‡­è¯
- **æ¥å£**: `GET /api/oss/upload-token`
- **è®¤è¯**: âœ… éœ€è¦
- **å‚æ•°**:
  - `type`: æ–‡ä»¶ç±»å‹ï¼ˆ`video` æˆ– `image`ï¼‰
- **å“åº”**:
```json
{
  "success": true,
  "data": {
    "accessKeyId": "STS.xxx",
    "accessKeySecret": "xxx",
    "securityToken": "xxx",
    "expiration": "2024-01-20T12:00:00Z",
    "region": "oss-cn-hangzhou",
    "bucket": "your-bucket",
    "endpoint": "https://oss-cn-hangzhou.aliyuncs.com"
  }
}
```

### 2. ç›´æ¥ä¸Šä¼ æ–‡ä»¶åˆ°OSS
**è¯´æ˜**: 
- å‰ç«¯ä½¿ç”¨OSS SDKç›´æ¥ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OSS
- å…ˆè°ƒç”¨ä¸Šè¿°æ¥å£è·å–ä¸´æ—¶å‡­è¯
- ä¸Šä¼ æˆåŠŸåè·å¾—æ–‡ä»¶URL
- å°†URLæäº¤åˆ°åç«¯APIï¼ˆå¦‚æ³¨å†Œã€ä¸Šä¼ è§†é¢‘ç­‰ï¼‰

---

## ğŸ”” æ¶ˆæ¯é€šçŸ¥æ¥å£ ğŸ†•

### 1. è·å–æœªè¯»æ¶ˆæ¯æ•°
- **æ¥å£**: `GET /api/message/unread-count`
- **è®¤è¯**: âœ… éœ€è¦
- **å“åº”**:
```json
{
  "success": true,
  "count": 5
}
```

### 2. è·å–æ¶ˆæ¯åˆ—è¡¨
- **æ¥å£**: `GET /api/message/list`
- **è®¤è¯**: âœ… éœ€è¦
- **å‚æ•°**:
  - `current`: å½“å‰é¡µç 
  - `size`: æ¯é¡µæ•°é‡
- **å“åº”**: è¿”å›æ¶ˆæ¯åˆ—è¡¨

### 3. æ ‡è®°æ¶ˆæ¯å·²è¯»
- **æ¥å£**: `POST /api/message/{id}/read`
- **è®¤è¯**: âœ… éœ€è¦

---

## âš ï¸ é”™è¯¯ç è¯´æ˜

| HTTPçŠ¶æ€ç  | è¯´æ˜ | ç¤ºä¾‹åœºæ™¯ |
|-----------|------|---------|
| 200 | è¯·æ±‚æˆåŠŸ | - |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | ç¼ºå°‘å¿…å¡«å­—æ®µã€æ ¼å¼é”™è¯¯ |
| 401 | æœªè®¤è¯æˆ–Tokenæ— æ•ˆ | æœªç™»å½•ã€Tokenè¿‡æœŸ |
| 403 | æƒé™ä¸è¶³ | æ™®é€šç”¨æˆ·è®¿é—®ç®¡ç†å‘˜æ¥å£ |
| 404 | èµ„æºä¸å­˜åœ¨ | è§†é¢‘IDä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æ•°æ®åº“è¿æ¥å¤±è´¥ |

---

## ğŸ”’ å®‰å…¨è¯´æ˜

### å¯†ç å®‰å…¨ ğŸ”
- âœ… æ‰€æœ‰å¯†ç ä½¿ç”¨ **BCrypt** åŠ å¯†å­˜å‚¨ï¼ˆ60å­—ç¬¦ï¼‰
- âœ… æ³¨å†Œå’Œç™»å½•æ—¶è‡ªåŠ¨å¤„ç†åŠ å¯†/éªŒè¯
- âœ… ç®¡ç†å‘˜æ— æ³•æŸ¥çœ‹ç”¨æˆ·æ˜æ–‡å¯†ç 
- âœ… å¯†ç ä¿®æ”¹éœ€éªŒè¯åŸå¯†ç 

### Tokenå®‰å…¨
- âœ… ä½¿ç”¨JWT (JSON Web Token)
- âœ… Tokenæœ‰æ•ˆæœŸ7å¤©
- âœ… æ•æ„Ÿæ“ä½œéœ€è¦TokenéªŒè¯

### æ•°æ®éªŒè¯
- âœ… æ‰€æœ‰è¾“å…¥å‚æ•°è¿›è¡ŒéªŒè¯
- âœ… SQLæ³¨å…¥é˜²æŠ¤ï¼ˆMyBatis Pluså‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- âœ… XSSé˜²æŠ¤ï¼ˆå‰ç«¯è¾“å…¥è½¬ä¹‰ï¼‰

---

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### ä½¿ç”¨curlæµ‹è¯•

#### 1. ç™»å½•
```bash
curl -X POST http://localhost:8080/api/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'
```

#### 2. è·å–è§†é¢‘åˆ—è¡¨
```bash
curl "http://localhost:8080/api/video/list?current=1&size=10"
```

#### 3. ä¸Šä¼ è§†é¢‘ï¼ˆéœ€è¦Tokenï¼‰
```bash
curl -X POST http://localhost:8080/api/video/upload \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOi..." \
  -d '{
    "title":"å‘¨æ°ä¼¦æ¼”å”±ä¼š",
    "city":"åŒ—äº¬",
    "concertDate":"2024-01-20",
    "videoUrl":"https://oss.aliyuncs.com/videos/xxx.mp4"
  }'
```

#### 4. ä¿®æ”¹å¯†ç 
```bash
curl -X POST http://localhost:8080/api/user/change-password \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOi..." \
  -d '{"oldPassword":"123456","newPassword":"654321"}'
```

---

## ğŸ“‹ æ¥å£æ¸…å•

| åˆ†ç±» | æ¥å£æ•°é‡ | è¯´æ˜ |
|------|---------|------|
| ç”¨æˆ· | 6 | æ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†ã€å¯†ç ä¿®æ”¹ |
| è§†é¢‘ | 7 | åˆ—è¡¨ã€è¯¦æƒ…ã€ä¸Šä¼ ã€å®¡æ ¸ã€åˆ é™¤ |
| è¯„è®º | 3 | æ·»åŠ ã€æŸ¥è¯¢ã€åˆ é™¤ |
| ç‚¹èµ | 2 | ç‚¹èµã€çŠ¶æ€æŸ¥è¯¢ |
| æ”¶è— | 3 | æ”¶è—ã€çŠ¶æ€æŸ¥è¯¢ã€åˆ—è¡¨ |
| OSS | 1 | ä¸Šä¼ å‡­è¯è·å– |
| æ¶ˆæ¯ | 3 | æœªè¯»æ•°ã€åˆ—è¡¨ã€å·²è¯» |
| **æ€»è®¡** | **25** | - |

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](./æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md)
- [é¡¹ç›®å¯åŠ¨æŒ‡å—](./é¡¹ç›®å¯åŠ¨æŒ‡å—.md)
- [å¯†ç åŠ å¯†å®‰å…¨æ–¹æ¡ˆ](./docs/security/walkthrough.md) ğŸ”
- [README](./README.md)
