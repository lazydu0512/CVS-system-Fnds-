# æ¼”å”±ä¼šè§†é¢‘åˆ†äº«å¹³å° - éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•
1. [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
2. [æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡](#æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡)
3. [åç«¯éƒ¨ç½²](#åç«¯éƒ¨ç½²)
4. [å‰ç«¯éƒ¨ç½²](#å‰ç«¯éƒ¨ç½²)
5. [Nginxé…ç½®](#nginxé…ç½®)
6. [æ•°æ®åº“éƒ¨ç½²](#æ•°æ®åº“éƒ¨ç½²)
7. [åŸŸåå’ŒHTTPSé…ç½®](#åŸŸåå’Œhttpsé…ç½®)
8. [ç›‘æ§å’Œç»´æŠ¤](#ç›‘æ§å’Œç»´æŠ¤)

## ğŸ—ï¸ éƒ¨ç½²æ¶æ„

### æ¨èæ¶æ„
```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ç”¨æˆ·æµè§ˆå™¨   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚    Nginx     â”‚
                    â”‚  (80/443)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                         â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
       â”‚  å‰ç«¯é™æ€æ–‡ä»¶  â”‚          â”‚  åç«¯APIæœåŠ¡  â”‚
       â”‚  (Vue Build)  â”‚          â”‚ (Spring Boot)â”‚
       â”‚              â”‚          â”‚   (8080)     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                 â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                 â”‚    MySQL     â”‚
                                 â”‚   (3306)     â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœ€å°é…ç½®
- **CPU**: 2æ ¸
- **å†…å­˜**: 4GB
- **ç¡¬ç›˜**: 50GB SSD
- **å¸¦å®½**: 5Mbps

### æ¨èé…ç½®
- **CPU**: 4æ ¸
- **å†…å­˜**: 8GB
- **ç¡¬ç›˜**: 100GB SSD
- **å¸¦å®½**: 10Mbps

## ğŸ”§ æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡

### 1. æ“ä½œç³»ç»Ÿ
æ¨èä½¿ç”¨ï¼š
- Ubuntu 20.04 LTS
- CentOS 7/8
- Debian 10/11

### 2. å®‰è£…JDK

#### Ubuntu/Debian
```bash
# æ›´æ–°è½¯ä»¶åŒ…
sudo apt update

# å®‰è£…OpenJDK 17
sudo apt install openjdk-17-jdk -y

# éªŒè¯å®‰è£…
java -version
```

#### CentOS
```bash
# å®‰è£…OpenJDK 17
sudo yum install java-17-openjdk-devel -y

# éªŒè¯å®‰è£…
java -version
```

### 3. å®‰è£…MySQL

#### Ubuntu/Debian
```bash
# å®‰è£…MySQL
sudo apt install mysql-server -y

# å¯åŠ¨MySQL
sudo systemctl start mysql
sudo systemctl enable mysql

# å®‰å…¨é…ç½®
sudo mysql_secure_installation
```

#### CentOS
```bash
# å®‰è£…MySQL
sudo yum install mysql-server -y

# å¯åŠ¨MySQL
sudo systemctl start mysqld
sudo systemctl enable mysqld
```

### 4. å®‰è£…Nginx

#### Ubuntu/Debian
```bash
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### CentOS
```bash
sudo yum install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

### 5. å®‰è£…Node.jsï¼ˆç”¨äºæ„å»ºå‰ç«¯ï¼‰

```bash
# ä½¿ç”¨NodeSourceå®‰è£…Node.js 18
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install nodejs -y

# éªŒè¯å®‰è£…
node -v
npm -v
```

## ğŸš€ åç«¯éƒ¨ç½²

### 1. æ‰“åŒ…åº”ç”¨

åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒï¼š
```bash
cd CVS-port

# æ¸…ç†å¹¶æ‰“åŒ…
mvn clean package -DskipTests

# æ‰“åŒ…å®Œæˆåï¼Œåœ¨targetç›®å½•ä¸‹ç”Ÿæˆjaræ–‡ä»¶
# ä¾‹å¦‚: cvs-port-0.0.1-SNAPSHOT.jar
```

### 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# ä½¿ç”¨scpä¸Šä¼ 
scp target/cvs-port-0.0.1-SNAPSHOT.jar user@server:/opt/cvs/

# æˆ–ä½¿ç”¨FTPå·¥å…·ä¸Šä¼ 
```

### 3. é…ç½®ç”Ÿäº§ç¯å¢ƒ

åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶ `application-prod.properties`:
```properties
# æ•°æ®åº“é…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/cvs_db?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
spring.datasource.username=cvs_user
spring.datasource.password=your_secure_password

# æœåŠ¡å™¨é…ç½®
server.port=8080

# æ–‡ä»¶ä¸Šä¼ é…ç½®
spring.servlet.multipart.max-file-size=500MB
spring.servlet.multipart.max-request-size=500MB

# æ—¥å¿—é…ç½®
logging.level.root=INFO
logging.file.name=/var/log/cvs/application.log
```

### 4. åˆ›å»ºå¯åŠ¨è„šæœ¬

åˆ›å»º `start.sh`:
```bash
#!/bin/bash
nohup java -jar -Dspring.profiles.active=prod cvs-port-0.0.1-SNAPSHOT.jar > /dev/null 2>&1 &
echo $! > app.pid
echo "Application started with PID: $(cat app.pid)"
```

åˆ›å»º `stop.sh`:
```bash
#!/bin/bash
if [ -f app.pid ]; then
    PID=$(cat app.pid)
    kill $PID
    rm app.pid
    echo "Application stopped"
else
    echo "PID file not found"
fi
```

èµ‹äºˆæ‰§è¡Œæƒé™ï¼š
```bash
chmod +x start.sh stop.sh
```

### 5. ä½¿ç”¨systemdç®¡ç†æœåŠ¡ï¼ˆæ¨èï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/cvs-backend.service`:
```ini
[Unit]
Description=CVS Backend Service
After=network.target mysql.service

[Service]
Type=simple
User=www-data
WorkingDirectory=/opt/cvs
ExecStart=/usr/bin/java -jar -Dspring.profiles.active=prod /opt/cvs/cvs-port-0.0.1-SNAPSHOT.jar
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl start cvs-backend
sudo systemctl enable cvs-backend
sudo systemctl status cvs-backend
```

## ğŸ¨ å‰ç«¯éƒ¨ç½²

### 1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬

åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒï¼š
```bash
cd CVS-view

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºå®Œæˆåï¼Œåœ¨distç›®å½•ä¸‹ç”Ÿæˆé™æ€æ–‡ä»¶
```

### 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# å‹ç¼©distç›®å½•
tar -czf dist.tar.gz dist/

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp dist.tar.gz user@server:/var/www/

# åœ¨æœåŠ¡å™¨ä¸Šè§£å‹
ssh user@server
cd /var/www
tar -xzf dist.tar.gz
mv dist cvs-frontend
```

## ğŸŒ Nginxé…ç½®

### 1. åˆ›å»ºNginxé…ç½®æ–‡ä»¶

åˆ›å»º `/etc/nginx/sites-available/cvs`:
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/cvs-frontend;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # æ–‡ä»¶ä¸Šä¼ é…ç½®
        client_max_body_size 500M;
    }

    # é™æ€èµ„æºï¼ˆä¸Šä¼ çš„æ–‡ä»¶ï¼‰
    location /uploads/ {
        alias /opt/cvs/uploads/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

### 2. å¯ç”¨é…ç½®

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/cvs /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

## ğŸ” åŸŸåå’ŒHTTPSé…ç½®

### 1. å®‰è£…Certbot

```bash
# Ubuntu/Debian
sudo apt install certbot python3-certbot-nginx -y

# CentOS
sudo yum install certbot python3-certbot-nginx -y
```

### 2. è·å–SSLè¯ä¹¦

```bash
sudo certbot --nginx -d your-domain.com
```

### 3. è‡ªåŠ¨ç»­æœŸ

```bash
# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run

# Certbotä¼šè‡ªåŠ¨æ·»åŠ cronä»»åŠ¡
```

## ğŸ’¾ æ•°æ®åº“éƒ¨ç½²

### 1. åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

```sql
-- ç™»å½•MySQL
mysql -u root -p

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE cvs_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·
CREATE USER 'cvs_user'@'localhost' IDENTIFIED BY 'your_secure_password';

-- æˆæƒ
GRANT ALL PRIVILEGES ON cvs_db.* TO 'cvs_user'@'localhost';
FLUSH PRIVILEGES;
```

### 2. å¯¼å…¥æ•°æ®

```bash
mysql -u cvs_user -p cvs_db < init.sql
```

### 3. æ•°æ®åº“å¤‡ä»½

åˆ›å»ºå¤‡ä»½è„šæœ¬ `backup.sh`:
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backup/mysql"
mkdir -p $BACKUP_DIR

mysqldump -u cvs_user -p'your_password' cvs_db > $BACKUP_DIR/cvs_db_$DATE.sql

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "cvs_db_*.sql" -mtime +7 -delete
```

æ·»åŠ åˆ°crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰ï¼š
```bash
0 2 * * * /opt/cvs/backup.sh
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### 1. æŸ¥çœ‹åº”ç”¨æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
sudo journalctl -u cvs-backend -f

# æŸ¥çœ‹Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### 2. ç›‘æ§ç³»ç»Ÿèµ„æº

```bash
# æŸ¥çœ‹CPUå’Œå†…å­˜ä½¿ç”¨
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -tulpn
```

### 3. æ€§èƒ½ä¼˜åŒ–

- å¯ç”¨Gzipå‹ç¼©
- é…ç½®æµè§ˆå™¨ç¼“å­˜
- ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- æ·»åŠ Redisç¼“å­˜

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨ç¯å¢ƒå·²å‡†å¤‡
- [ ] JDKå·²å®‰è£…
- [ ] MySQLå·²å®‰è£…å¹¶é…ç½®
- [ ] Nginxå·²å®‰è£…å¹¶é…ç½®
- [ ] åç«¯åº”ç”¨å·²éƒ¨ç½²å¹¶è¿è¡Œ
- [ ] å‰ç«¯é™æ€æ–‡ä»¶å·²éƒ¨ç½²
- [ ] æ•°æ®åº“å·²åˆ›å»ºå¹¶å¯¼å…¥æ•°æ®
- [ ] Nginxé…ç½®å·²ç”Ÿæ•ˆ
- [ ] åŸŸåå·²è§£æ
- [ ] HTTPSè¯ä¹¦å·²é…ç½®
- [ ] é˜²ç«å¢™è§„åˆ™å·²é…ç½®
- [ ] æ—¥å¿—å’Œç›‘æ§å·²é…ç½®
- [ ] æ•°æ®åº“å¤‡ä»½å·²é…ç½®

## ğŸ†˜ æ•…éšœæ’æŸ¥

è¯¦è§ [å¸¸è§é—®é¢˜FAQ.md](./å¸¸è§é—®é¢˜FAQ.md)

