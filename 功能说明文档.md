# 演唱会视频分享平台 - 功能说明文档

## 📖 系统概述

演唱会视频分享平台是一个基于Spring Boot + Vue3的全栈Web应用，旨在为演唱会爱好者提供一个分享和观看演唱会视频的平台。系统支持用户注册登录、视频上传分享、评论互动、点赞收藏等功能，并提供管理员审核机制确保内容质量。

## 🎯 核心功能

### 1. 用户系统

#### 1.1 用户注册 🆕
- **功能描述**：新用户可以注册账号
- **必填信息**：头像、用户名、密码、昵称
- **可选信息**：邮箱、手机号
- **头像上传** 🔥：
  - 支持上传图片（JPG/PNG/GIF/WebP）
  - 内置图片裁剪功能（1:1比例）
  - 支持拖动、缩放调整
  - 本地预览后上传到OSS
- **验证规则**：
  - 用户名唯一性检查
  - 邮箱格式验证
  - 密码强度要求（至少6位）
- **默认角色**：普通用户（role=0）
- **界面优化**：
  - 登录/注册使用统一弹窗
  - 底部切换链接（"去注册"/"去登录"）
  - 简洁美观的用户体验

#### 1.2 用户登录 🔐
- **功能描述**：已注册用户登录系统
- **登录方式**：用户名 + 密码
- **认证机制**：JWT Token认证
- **会话管理**：Token存储在localStorage
- **安全措施** 🔒：
  - **BCrypt密码加密**：工业级密码存储
  - 随机盐值，每次加密结果不同
  - 抗暴力破解和彩虹表攻击
  - 密码不可逆，数据库泄露无法获取明文

#### 1.3 个人中心
- **查看个人信息**：头像、昵称、邮箱、手机号、注册时间
- **修改个人信息**：更新头像、昵称、邮箱、手机号
- **头像管理**：可重新上传并裁剪头像
- **密码修改** 🔐：
  - 需验证原密码（BCrypt验证）
  - 新密码自动BCrypt加密
  - 管理员可重置用户密码
- **我的视频**：查看自己上传的所有视频及审核状态
- **我的收藏**：查看收藏的视频列表

### 2. 视频管理

#### 2.1 视频浏览
- **视频列表**：
  - 分页显示审核通过的视频
  - 每页默认显示10条
  - 支持翻页功能
- **视频信息**：
  - 标题、描述
  - 城市、演唱会日期
  - 上传者信息
  - 观看数、点赞数、收藏数
  - 缩略图

#### 2.2 视频搜索
- **搜索方式**：
  - 按标题关键词搜索
  - 按城市筛选
  - 组合搜索
- **搜索结果**：实时更新，支持分页

#### 2.3 视频详情
- **基本信息**：完整的视频信息展示
- **视频播放**：支持在线播放（需要有效的视频URL）
- **互动功能**：点赞、收藏、评论
- **相关推荐**：同城市或同类型视频推荐

#### 2.4 视频上传（需登录）
- **上传流程**：
  1. 填写视频基本信息
  2. 上传视频文件
  3. 上传封面图片（可选）
  4. 提交审核
- **文件限制**：
  - 视频大小：最大500MB
  - 支持格式：mp4, avi, mov等
  - 封面格式：jpg, png, gif
- **审核状态**：
  - 0：待审核（默认）
  - 1：审核通过
  - 2：审核拒绝

### 3. 社交互动

#### 3.1 评论功能（需登录）
- **发表评论**：
  - 在视频详情页发表评论
  - 支持文本内容
  - 实时显示
- **查看评论**：
  - 按时间倒序显示
  - 显示评论者昵称和时间
- **删除评论**：
  - 用户可删除自己的评论
  - 管理员可删除任何评论
- **评论回复**：支持二级评论（已实现数据结构）

#### 3.2 点赞功能（需登录）
- **点赞操作**：
  - 点击点赞按钮
  - 再次点击取消点赞
- **点赞状态**：
  - 实时更新点赞数
  - 保存用户点赞状态
  - 刷新页面保持状态
- **防重复**：同一用户对同一视频只能点赞一次

#### 3.3 收藏功能（需登录）
- **收藏操作**：
  - 点击收藏按钮
  - 再次点击取消收藏
- **收藏列表**：
  - 在个人中心查看
  - 按收藏时间倒序
  - 支持快速访问
- **收藏统计**：实时更新收藏数

### 4. 管理员功能

#### 4.1 视频审核
- **待审核列表**：
  - 查看所有待审核视频
  - 显示上传者、上传时间
  - 预览视频内容
- **审核操作**：
  - 通过：视频在前台可见
  - 拒绝：视频不可见，记录拒绝原因
- **审核记录**：
  - 记录审核人
  - 记录审核时间
  - 记录审核意见

#### 4.2 用户管理
- **用户列表**：查看所有注册用户
- **用户状态**：启用/禁用用户账号
- **角色管理**：设置用户角色（普通用户/管理员）

#### 4.3 数据统计
- **视频统计**：
  - 总视频数
  - 待审核数
  - 审核通过数
  - 审核拒绝数
- **用户统计**：
  - 总用户数
  - 活跃用户数
- **互动统计**：
  - 总评论数
  - 总点赞数
  - 总收藏数

## 🔐 权限控制

### 角色定义
| 角色 | role值 | 权限 |
|------|--------|------|
| 普通用户 | 0 | 浏览、上传、评论、点赞、收藏 |
| 城市管理员 | 1 | 普通用户权限 + 视频审核 + 用户管理 |

### 访问控制
- **公开访问**：首页、视频列表、视频详情、注册、登录
- **登录访问**：上传视频、评论、点赞、收藏、个人中心
- **管理员访问**：管理后台、视频审核、用户管理

## 📊 数据库设计

### 核心表结构
1. **user**：用户表
2. **video**：视频表
3. **comment**：评论表
4. **video_like**：视频点赞表
5. **video_collect**：视频收藏表

### 关系说明
- 用户 1:N 视频（上传关系）
- 用户 1:N 评论
- 视频 1:N 评论
- 用户 M:N 视频（点赞关系）
- 用户 M:N 视频（收藏关系）

## 🔧 技术实现

### 后端技术
- **框架**：Spring Boot 3.2.1
- **ORM**：MyBatis Plus 3.5.7
- **数据库**：MySQL 8.0
- **认证**：JWT (jjwt 0.11.5)
- **安全** 🔐：Spring Security Crypto (BCrypt)
- **云存储**：阿里云OSS SDK
- **工具**：Lombok（简化代码）

### 前端技术
- **框架**：Vue 3（Composition API）
- **路由**：Vue Router 4
- **状态管理**：Pinia 2
- **UI组件**：Element Plus
- **HTTP客户端**：Axios
- **构建工具**：Vite 5
- **图片裁剪** 🆕：vue-cropper

### 核心特性
- **RESTful API**：统一的接口设计
- **JWT Token认证**：安全的用户认证
- **BCrypt密码加密** 🔒：工业级密码存储
- **阿里云OSS**：视频和图片云存储
- **图片裁剪**：在线裁剪调整头像
- **CORS支持**：跨域资源共享
- **文件上传**：支持大文件上传
- **分页查询**：优化数据加载
- **异常处理**：全局异常捕获
- **参数化查询**：防止SQL注入

## ✅ 最新更新 (2026-02-01)

### 安全升级 🔐
- ✅ **BCrypt密码加密**：所有用户密码使用工业级加密算法
- ✅ **密码迁移脚本**：现有明文密码安全迁移
- ✅ **安全验证**：登录、修改密码均使用BCrypt验证
- ✅ **禁用明文查看**：管理员无法查看用户明文密码

### UI优化 🎨
- ✅ **头像上传裁剪**：注册时支持在线裁剪头像（vue-cropper）
- ✅ **登录注册弹窗**：优化为统一弹窗，底部切换链接
- ✅ **本地预览**：头像上传前本地预览，注册成功后上传OSS
- ✅ **B站风格界面**：现代化、美观的用户界面

## 🚀 扩展功能建议

### 短期扩展
1. ✅ 云存储集成（阿里云OSS）- 已完成
2. ✅ 图片裁剪功能 - 已完成
3. 视频播放器优化（使用Video.js）
4. 图片懒加载
5. 搜索历史记录
6. 热门视频推荐

### 中期扩展
1. 视频转码服务
2. 消息通知系统
3. 用户关注功能
4. 视频弹幕功能

### 长期扩展
1. 移动端APP
2. 微信/QQ登录
3. AI内容审核
4. 直播功能

## 📝 使用说明

详细的使用说明请参考：
- [项目启动指南.md](./项目启动指南.md)
- [测试清单.md](./测试清单.md)
- [README.md](./README.md)

